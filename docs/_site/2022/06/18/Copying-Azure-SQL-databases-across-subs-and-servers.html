<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Copying Azure SQL Databases across Subscriptions and Servers | John Sun’s notes</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Copying Azure SQL Databases across Subscriptions and Servers" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In a working environment, oftentimes data needs to be copied from the production database to lower environments." />
<meta property="og:description" content="In a working environment, oftentimes data needs to be copied from the production database to lower environments." />
<link rel="canonical" href="http://localhost:4000/2022/06/18/Copying-Azure-SQL-databases-across-subs-and-servers.html" />
<meta property="og:url" content="http://localhost:4000/2022/06/18/Copying-Azure-SQL-databases-across-subs-and-servers.html" />
<meta property="og:site_name" content="John Sun’s notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-18T01:47:29-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Copying Azure SQL Databases across Subscriptions and Servers" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-18T01:47:29-07:00","datePublished":"2022-06-18T01:47:29-07:00","description":"In a working environment, oftentimes data needs to be copied from the production database to lower environments.","headline":"Copying Azure SQL Databases across Subscriptions and Servers","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022/06/18/Copying-Azure-SQL-databases-across-subs-and-servers.html"},"url":"http://localhost:4000/2022/06/18/Copying-Azure-SQL-databases-across-subs-and-servers.html"}</script>
<!-- End Jekyll SEO tag -->
<!-- Favicon -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="John Sun&apos;s notes" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">John Sun&#39;s notes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Copying Azure SQL Databases across Subscriptions and Servers</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-06-18T01:47:29-07:00" itemprop="datePublished">Jun 18, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In a working environment, oftentimes data needs to be copied from the production database to lower environments.</p>

<p>Below I will show a quick method to copy Azure SQL databases across different SQL servers and subscriptions.</p>

<p>If you have been exporting and importing databases in the past, this method will be much faster and guarantees transaction consistency with Azure’s copy functionality. While in the GUI it looks like you are only able to copy to other servers in the subscription, you can circumvent this restriction with SSMS.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>You will need administrative access to both Azure SQL servers, and be able to connect to them via SSMS.</p>

<h2 id="method">Method</h2>

<p>In SSMS Connect to both the source and target SQL servers</p>

<p>In the source server, add the admin account of the target server with DB owner permissions, here are the commands:</p>

<p>Master database</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">CREATE</span> <span class="no">LOGIN</span> <span class="n">sourceadmin</span> <span class="p">(</span><span class="n">replace</span> <span class="n">this</span> <span class="n">with</span> <span class="n">your</span> <span class="n">target</span><span class="err">’</span><span class="n">s</span> <span class="n">admin</span> <span class="n">account</span> <span class="nb">name</span><span class="p">)</span> <span class="no">WITH</span> <span class="no">PASSWORD</span> <span class="o">=</span> <span class="err">‘</span><span class="o">**********</span><span class="err">’</span><span class="p">;</span><span class="sb">` (Choose a password)</span></code></pre></figure>

<p>On the target database:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">CREATE</span> <span class="no">USER</span> <span class="n">sourceadmin</span> <span class="no">FROM</span> <span class="no">LOGIN</span> <span class="n">sourceadmin</span> <span class="p">;</span>
<span class="nb">exec</span> <span class="n">sp_addrolemember</span> <span class="err">‘</span><span class="n">db_owner</span><span class="err">’</span><span class="p">,</span> <span class="err">‘</span><span class="n">sql1uvadmin</span><span class="err">’</span><span class="p">;</span>
<span class="no">GO</span></code></pre></figure>

<p>Once the permissions have been set, run the below line to create a new DB</p>

<p><code class="language-plaintext highlighter-rouge">CREATE DATABASE lowerEnvDBname AS COPY OF SourceServer.DatabaseName;</code></p>

<p>That’s it!</p>

<p>You may (or may not) want to clean up the account you created in your production environment at the start</p>

  </div><a class="u-url" href="/2022/06/18/Copying-Azure-SQL-databases-across-subs-and-servers.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">John Sun&#39;s notes</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">John Sun&#39;s notes</li><li><a class="u-email" href="mailto:johnsunjohn@msn.com">johnsunjohn@msn.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/rawpatty"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">rawpatty</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A collection of notes from experience working across Microsoft technologies</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
